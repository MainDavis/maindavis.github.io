---
import { getCollection } from "astro:content";
import ContentCard from "../../../components/ContentCard.astro";
import BlogLayout from "../../../layouts/BlogLayout.astro";

export async function getStaticPaths() {
  return ["es", "en"].map((lang) => ({ params: { lang } }));
}

const locale = Astro.params.lang ?? "es";
const isEs = locale === "es";
const blogCollection = isEs ? "blogEs" : "blogEn";
const dateLocale = isEs ? "es-ES" : "en-US";
const posts = (await getCollection(blogCollection)).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);
---

<BlogLayout
  title="~/blog"
  description={
    isEs ? "Entradas recientes y reportes operativos." : "Recent blog entries and ops reports."
  }
>
  <div class="grid gap-6 md:grid-cols-2">
    {posts.map((post) => (
      <ContentCard
        href={`/${locale}/blog/${post.slug}`}
        title={post.data.title}
        description={post.data.description}
        tags={post.data.tags}
        image={post.data.image}
        variant="blog"
        meta={post.data.date.toLocaleDateString(dateLocale)}
        locale={locale}
      />
    ))}
  </div>
</BlogLayout>
